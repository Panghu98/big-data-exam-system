<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.swpu.jdata_exam.dao.UserScoreDAO">

    <!--UserScore getScoreById(String userId);-->
    <select id="getScoreById" resultType="cn.edu.swpu.jdata_exam.entity.UserScore2">
        SELECT
        a.user_id userId,max(accuracy) as  accuracy ,a.date_time as `datetime`,b.username as username
        FROM
        jdata_user_score a inner join jdata_user_basic_info b on a.user_id = b.user_id
        WHERE
        a.user_id=#{userId}
        group BY a.date_time DESC
    </select>

    <!--int addScore(UserScore userScore);-->
    <insert id="addScore" parameterType="cn.edu.swpu.jdata_exam.entity.UserScore">
        INSERT INTO
            jdata_user_score
            (user_id,date_time,accuracy,frequency)
        VALUES
            (#{userId},#{dateTime},#{accuracy},#{frequency})

    </insert>

    <select id="selectByTime" parameterType="date" resultType="cn.edu.swpu.jdata_exam.entity.UserScore">
        select distinct a.`user_id` as userId,a.accuracy as accuracy,b.user_class as className,a.date_time as dateTime
        from jdata_user_score a inner join jdata_user_basic_info b
        on  a.user_id = b.user_id order by className ,userId ;
    </select>


    <select id="getRankingList" resultType="cn.edu.swpu.jdata_exam.entity.UserScore2">
        select a.user_id  as userId,max(accuracy) as accuracy,b.username as username
        from jdata_user_score a
        inner join jdata_user_basic_info b on a.user_id = b.user_id  where a.user_id in
        <foreach collection="list" separator="," open="(" close=")" index="" item="type">
            #{type, jdbcType=VARCHAR}
        </foreach>

        group by userId order by accuracy desc
    </select>
    <select id="getUserList" resultType="java.lang.Long">
        select distinct user_id from jdata_user_score ;
    </select>
    <select id="getBestScore" resultType="cn.edu.swpu.jdata_exam.entity.UserScore2">
        select a.user_id  as userId,max(accuracy) as accuracy,b.username as username
        from jdata_user_score a
        inner join jdata_user_basic_info b on a.user_id = b.user_id
        where a.user_id = #{userId};
    </select>


</mapper>